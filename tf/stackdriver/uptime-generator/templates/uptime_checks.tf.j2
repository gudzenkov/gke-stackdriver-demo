# Auto-generated by uptime-generator.py
#
# Uptime checks and Alerting Policy for health-check endpoints
# Various Content Matchers supported
# Login Proxy auth can be passed for JWT token authorization

{%- for check in checks %}
{%- if check['code'] == '200' %}

module "{{ check['name'] | replace('/','-') }}" {
  source     = "../modules/stackdriver-uptime-check"
  name       = "${var.api_gateway}/{{ check['name'] }}"
    {%- if check['auth'] == 'False' %}
  host       = "${var.api_gateway}"
    {%- elif check['auth'] == 'True' %}
  host       = "${var.uptime_check_proxy}"
  auth_token = "${var.uptime_check_proxy_token}"
    {%- endif %}
  path       = "/{{ check['name'] }}{{ check['uri'] }}"
    {%- if check['matcher'] == 'OK' %}
  match      = "${var.uptime_check_match_ok}"
    {%- elif check['matcher'] == 'app' %}
  match      = "${var.uptime_check_match_app_health}"
    {%- elif check['matcher'] != '<EMPTY>' %}
  match      = "{{ check['matcher'] | replace('"','\\"') }}"
    {%- endif %}
}
{%- endif%}
{%- endfor %}
